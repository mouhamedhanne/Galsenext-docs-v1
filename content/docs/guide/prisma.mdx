---
title: Prisma
description: Guide complet pour configurer et utiliser Galsenext après l'installation.
---

# Configuration de Prisma

**Galsenext** utilise `Prisma` comme ORM (Object-Relational Mapping) pour interagir avec la base de données. `Prisma` facilite la gestion de vos données et l'interaction avec votre base de données `PostgreSQL`.

## Configuration de l'Instance Prisma

Dans **Galsenext**, Prisma est configuré pour fonctionner de manière optimale
à la fois en mode développement et en production. Le fichier `prisma.ts`
situé dans le répertoire `/src/lib/` est configuré pour créer une instance
unique de Prisma qui est réutilisée tout au long de l'application,
permettant ainsi d'optimiser les performances et de minimiser les
problèmes de connexion à la base de données.

```bash
// @ts-nocheck

import { PrismaClient } from "@prisma/client";

export const prisma: PrismaClient =
  global.prisma ??
  new PrismaClient({
    log:
      process.env.NODE_ENV === "development"
        ? ["query", "error", "warn"]
        : ["error"],
  });

if (process.env.NODE_ENV !== "production") {
  global.prisma = prisma;
}
```

- **Création d'une Instance Unique de Prisma** : L'instance de Prisma est
  stockée dans la variable globale `global.prisma` pour éviter de créer
  plusieurs instances dans un environnement de développement, ce qui
  pourrait entraîner des erreurs de connexion à la base de données.
  Cette approche est particulièrement utile avec `Next.js` qui utilise un
  système de rafraîchissement automatique des modules en mode développement.
- **Configuration des Logs de Prisma** : En mode développement
  (`process.env.NODE_ENV === "development"`), Prisma est configuré pour
  afficher les logs de requêtes, les erreurs et les avertissements
  (`["query", "error", "warn"]`). En production, seuls les logs d'erreurs
  sont activés (`["error"]`) pour éviter d'exposer des informations sensibles.
- **Vérification de l'Environnement** : Le code vérifie si l'environnement
  n'est pas en production (`process.env.NODE_ENV !== "production"`). Dans
  ce cas, il assigne l'instance de Prisma à `global.prisma` pour garantir
  qu'une seule instance est utilisée tout au long du cycle de vie de
  l'application.

## Configuration Initiale de Prisma

Le fichier de schéma Prisma `prisma/schema.prisma` est déjà configuré pour l'authentification de base. Voici comment configurer et utiliser Prisma :

### 1. Initialisation de Prisma

Lorsque vous avez installé Galsenext, `Prisma` est déjà inclus. Vous devez configurer votre base de données en suivant ces étapes :

#### Migration de la Base de Données

Pour appliquer le schéma Prisma à votre base de données, exécutez la commande suivante :

```bash
npx prisma migrate dev --name init
```

Cette commande créera les tables nécessaires pour l'authentification et préparera votre base de données.

### 2. Modification du Schéma Prisma

Le `schéma` par défaut est suffisant pour gérer **l'authentification**.
Cependant, vous pouvez modifier ce fichier en fonction de vos besoins.
Par exemple, si vous souhaitez ajouter des modèles pour des fonctionnalités
spécifiques, modifiez le fichier `prisma/schema.prisma` :

```bash
model Post {
  id        Int      @id @default(autoincrement())
  title     String
  content   String
  author    User     @relation(fields: [authorId], references: [id])
  authorId  Int
  createdAt DateTime @default(now())
}
```

#### Application des Changements

Après avoir modifié le fichier `schema.prisma`, vous devez exécuter une
nouvelle migration pour appliquer ces changements à votre base de données :

```bash
npx prisma migrate dev --name add-post-model
```

Cette commande mettra à jour la base de données en ajoutant le nouveau modèle ou en appliquant d'autres modifications que vous avez faites au schéma.

### Points à Vérifier

- **Vérifiez la Configuration** : Assurez-vous que le fichier `.env`
  contient les informations correctes pour se connecter à votre base de
  données [voir Configuration des Variables d’Environnement](https://galsenext-docs.vercel.app/docs/guide/configuration#configuration-du-fichier-env).
- **Consultez la Documentation Prisma** : Pour plus de détails sur l'utilisation de `Prisma` et des fonctionnalités avancées, consultez la [documentation officielle de Prisma](https://www.prisma.io/docs).
